___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Thinking Engine - 초기화 및 자동 수집",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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"
  },
  "description": "이 태그 템플릿은 Thinking Engine(TE)의 공식 JavaScript SDK를 웹사이트에 안전하게 주입하고, 초기화하며, 기본적인 자동 수집 이벤트를 활성화하는 역할을 합니다.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "appId",
    "displayName": "App ID",
    "simpleValueType": true,
    "help": "Thinking Engine 프로젝트의 App ID를 입력하세요. \nTE 프로젝트 관리 페이지에서 찾을 수 있습니다.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "serverUrl",
    "displayName": "서버 URL",
    "simpleValueType": true,
    "help": "데이터 수신 URL입니다.",
    "defaultValue": "https://te-receiver-naver.thinkingdata.kr/sync_js",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "sdkUrl",
    "displayName": "SDK URL (선택 사항)",
    "simpleValueType": true,
    "defaultValue": "https://cdn.jsdelivr.net/npm/thinkingdata-browser",
    "help": "자체 호스팅하는 SDK를 사용하거나 특정 버전의 SDK를 로드할 경우 URL을 입력하세요"
  },
  {
    "type": "CHECKBOX",
    "name": "enablePageShowHide",
    "checkboxText": "페이지 표시/숨김 자동 수집 활성화",
    "simpleValueType": true,
    "defaultValue": true,
    "help": "체크하면 ta_page_show와 ta_page_hide 이벤트를 자동으로 수집합니다."
  },
  {
    "type": "CHECKBOX",
    "name": "enablePageView",
    "checkboxText": "페이지뷰 자동 수집 활성화",
    "simpleValueType": true,
    "help": "체크하면 ta.quick(\"autoTrack\")을 호출하여 ta_pageview 이벤트를 자동으로 수집합니다.",
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "enableSdkLogging",
    "checkboxText": "Thinking Engine SDK 로그 활성화",
    "simpleValueType": true,
    "help": "체크하면 SDK 자체의 상세 디버그 로그가 브라우저 콘솔에 표시됩니다. 운영 환경에서는 비활성화를 권장합니다.",
    "defaultValue": false
  },
  {
    "type": "TEXT",
    "name": "instanceName",
    "displayName": "인스턴스 이름",
    "simpleValueType": true,
    "help": "이 Thinking Engine의 인스턴스 이름입니다. 다중 인스턴스를 사용하시려면 각각 다른 이름으로 입력하시면 됩니다. (기본값은 \"ta\"입니다.)",
    "defaultValue": "ta"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const logToConsole = require('logToConsole');

// GTM의 디버그 모드와는 별개로, 템플릿 자체의 로그를 위한 변수
const enableTemplateLogging = data.enableSdkLogging; 

if (enableTemplateLogging) {
  logToConsole('TA Template: SDK Injection Started. URL:', data.sdkUrl);
}

injectScript(data.sdkUrl, () => {
  if (enableTemplateLogging) {
    logToConsole('TA Template: SDK Loaded Successfully.');
  }

  // 1. 초기화 설정 객체 생성
  const config_gtm = {
    appId: data.appId,
    serverUrl: data.serverUrl,
    autoTrack: {
      pageShow: !!data.enablePageShowHide,
      pageHide: !!data.enablePageShowHide
    },
    // 이 체크박스 필드 값에 따라 SDK 로그 활성화 여부가 결정됩니다.
    showLog: !!data.enableSdkLogging
  };

  // 2. 전역 객체(thinkingdata)에 SDK 할당 및 초기화
  callInWindow('thinkingdata.init', config_gtm);
  
  // 3. 다른 태그에서 쉽게 사용할 수 있도록 인스턴스 생성 (이름은 data.instanceName으로 지정)
  callInWindow('thinkingdata.initInstance', data.instanceName || 'ta');
  
  // 4. 페이지뷰 자동 수집 활성화
  if (data.enablePageView) {
    if (enableTemplateLogging) {
      logToConsole('TA Template: Auto Pageview Tracking Enabled.');
    }
    const instanceName = data.instanceName || 'ta';
    callInWindow(instanceName + '.quick', 'autoTrack');
  }

  // 5. GTM에 성공 신호 전송
  data.gtmOnSuccess();

}, () => {
  if (enableTemplateLogging) {
    logToConsole('TA Template Error: Failed to load SDK.');
  }
  data.gtmOnFailure();
}, data.sdkUrl);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "thinkingdata.init"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "thinkingdata.initInstance"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ta.quick"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/npm/thinkingdata-browser"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2025. 7. 25. 오전 11:33:19


